<project basedir=".">
  
  <target name="rpm" depends="init">
    <copy tofile="${user.home}/rpmbuild/SOURCES/${shortproduct}-${version}.tar.gz"
          file="${dist}/${shortproduct}-${version}.tar.gz"
          overwrite="true"/>

    <copy file="make/resin.spec.in"
          tofile="${dist}/resin.spec"
          overwrite="true">
      <filterset>
        <filter token="VERSION" value="${version}"/>
      </filterset>
    </copy>

    <exec executable="rpmbuild">
      <arg line="-bb resin.spec"/>
    </exec>
  </target>
  
  <target name="rpm-sign" depends="init">
    <copy tofile="${user.home}/rpmbuild/SOURCES/${shortproduct}-${version}.tar.gz"
          file="${dist}/${shortproduct}-${version}.tar.gz"/>

    <copy file="resin.spec.in"
          tofile="resin.spec"
          overwrite="true">
      <filterset>
        <filter token="VERSION" value="${version}"/>
      </filterset>
    </copy>

    <exec executable="rpmbuild">
      <arg line="-bb resin.spec --sign"/>
    </exec>
  </target>

  <target name="dist.rpm" depends="dist.configure.make">
    <exec dir="${dist}/${dist.name}" executable="checkinstall">
      <arg line="-R --install=no --fstrans=yes -y" />
    </exec>

    <copy todir="${dist}">
      <fileset dir="${dist}/RPMS">
        <include name="**/*.rpm"/>
      </fileset>
    </copy>
  </target>

</project>
